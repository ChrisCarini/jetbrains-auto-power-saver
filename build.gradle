buildscript {
  ext {
    javaVersion = '1.8'

    // see https://www.jetbrains.com/intellij-repository/releases/
    // and https://www.jetbrains.com/intellij-repository/snapshots/
    // To use/download EAP add '-EAP-SNAPSHOT' to the version, i.e. 'IU-191.6014.8-EAP-SNAPSHOT'
    intellijVersion = '2019.3'
  }
}

plugins {
  id 'java'
  id 'org.jetbrains.intellij' version '0.4.9'
}

group 'com.chriscarini.jetbrains'
version '1.1.0'

sourceCompatibility = javaVersion

repositories {
  mavenCentral()
}

test {
  useTestNG()
  useJUnit()
}

dependencies {
  testCompile 'org.testng:testng:6.1.1'
  testCompile "org.mockito:mockito-core:2.18.0"
}

intellij {
  version intellijVersion
  plugins[]
  pluginName 'Automatic Power Saver'
}

//runIde {
//  jbrVersion 'jbrex8u202b1483.21'
//}

patchPluginXml {
  changeNotes """
        <h2>[1.1.0] - 2019-11-28</h2>
        <h3>Upgrade</h3>
        <ol>
        <li>Upgrading to 2019.3.</li>
        </ol>
        <h3>Added</h3>
        <ol>
        <li>N/A</li>
        </ol>
        <h3>Fixed</h3>
        <ol>
        <li><a href="https://github.com/ChrisCarini/jetbrains-auto-power-saver/issues/4">#4</a> - "Must be executed on UI thread" exception when alt+tabbing into the IDE</li>
        </ol>
        """
}

if (System.getenv('IS_CI') != "True") {
  // The below file (jetbrainsCredentials.gradle) should contain the below:
  //    project.ext.set("intellijPublishUsername", "YOUR_USERNAME_HERE")
  //    project.ext.set("intellijPublishPassword", "YOUR_PASSWORD_HERE")
  //    project.ext.set("intellijPluginPublishToken", "YOUR_TOKEN_HERE")
  //
  // Because this contains the username and password, this file is also included in .gitignore file.
  apply from: 'jetbrainsCredentials.gradle'

  publishPlugin {
//    username intellijPublishUsername
//    password intellijPublishPassword
    token intellijPluginPublishToken
  }

  task checkJetBrainsCreds {
    doLast {
      println "Username: " + intellijPublishUsername
      println "Password " + (project.hasProperty('intellijPublishPassword') ? "IS" : "is NOT") + " set."
    }
  }
}
